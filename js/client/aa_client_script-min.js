jQuery(document).ready(function($){var a=aaServerData.ajaxUrl;window.aaUploadSdfmonFile=function(e){if(e.preventDefault(),window.console.log(this),void 0===typeof this.files[0])return window.console.log("No hay archivo. Undefined"),this;var n=this.files[0];if(""===n.name.trim())return $.alert("No has seleccionado un archivo."),window.console.log("No file selected"),this;if(window.console.log("Archivo a evaluar: "+n.name+" "+n.type+" "+n.size),"text/plain"!==n.type)return $.alert("Recuerda que debes cargar archivos exportados sin formato"),!1;var o=$(this).data("file-date").split("/"),t=o[0],i=o[1],d=o[2],s=new FormData;s.append("action","fe_sdfmon_file_upload");var r=window.location.hash.split("/"),l=r[1];s.append("system_id",l),s.append("year",t),s.append("month",i),s.append("day",d),s.append("file_name",n.name),s.append("file",n);var c=$("<div class='uploading-msg'></div>").hide(),p='<i class="fa fa-cloud-upload" aria-hidden="true"></i>',h='<i class="fa fa-gear fa-spin" aria-hidden="true"></i>',u='<i class="fa fa-check" aria-hidden="true"></i>';$("#sdfmon-setup .sdfmon-setup-status").append(c),$.ajax({url:a,type:"POST",data:s,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){c.html(p+" "+d+"/"+i+"/"+t+" Comienza la carga del archivo <small>"+n.name+"</small>").fadeIn(500)},xhr:function(){var a=new window.XMLHttpRequest;return a.upload.addEventListener("progress",function(a){if(a.lengthComputable){var e=Math.round(a.loaded/a.total*100);window.console.log("Porcentaje: "+e),c.html(p+" "+d+"/"+i+"/"+t+" Cargando archivo <small>"+n.name+"</small> ("+e+"%)")}},!1),a.upload.addEventListener("load",function(a){a.lengthComputable&&c.html(h+" "+d+"/"+i+"/"+t+" Procesando la informaci&oacute;n cargada")},!1),a.addEventListener("progress",function(a){if(a.lengthComputable){var e=Math.round(a.loaded/a.total*100);window.console.log("Respuesta descargada: "+e+"%")}},!1),a},success:function(a){"ok"===a.status?(c.html(u+" "+d+"/"+i+"/"+t+" &iexcl;Informaci&oacute;n cargada exitosamente!").delay(5e3).fadeOut(1e3),window.console.log("OK: Carga de "+n.name),$("#sdfmon-setup").aaActivateSdfmonCalendar()):window.console.log("ERROR: Carga de "+n.name+"("+a.error+")")},error:function(a,e,n){window.console.log("ERROR: "),window.console.log(a),window.console.log(e+" - "+n),$.alert("Error. Contacte a su Adminsitrador.")}})},$.fn.extend({aaAnimateAndStopCss:function(a){return this.addClass("animated "+a),this},aaAnimateCss:function(a){var e="webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend";return this.addClass("animated "+a).one(e,function(){$(this).removeClass("animated "+a)}),this},aaNavbarFixedBehavior:function(a){return"on"===a?$(this).addClass("navbar-fixed-top"):"off"===a&&$(this).removeClass("navbar-fixed-top"),this},aaNavbarActiveSection:function(){var a=$(this),e=a.attr("href"),n=$(e);return n.length<1?this:(n.scrollex({mode:"middle",enter:function(){a.parent().addClass("active")},leave:function(){a.parent().parent().find(".active").removeClass("active")}}),this)},aaLoadContent:function(){if($(this).length<1||!$(this).parent().is("body"))return window.location.hash="#intro",this;var a=$(this).selector;switch(a){case"#system-list":$(this).ajaxSystemList(),$("body").addClass("on-system");break;case"#system-info":$(this).ajaxSystemInfo(),$("body").addClass("on-system");break;case"#sdfmon-setup":$(this).ajaxSdfmonSetup(),$("body").addClass("on-system");break;case"#edit-report":$("body").addClass("on-system"),$(this).aaContinueLoadContent();break;case"#report-preview":$("body").addClass("on-system"),$(this).ajaxReportPreview();break;default:$(this).aaContinueLoadContent(),$("body").removeClass("on-system")}return this},aaTurnOn:function(){return $(this).addClass("active").removeClass("hidden"),this},aaTurnOff:function(){return $(this).addClass("hidden").removeClass("active"),this},aaContinueLoadContent:function(){var a=$(this).selector,e=$("body > .active");if(window.console.log("activos :"+e.length),e.length<1)return window.console.log("no hay activos"),$(this).aaTurnOn(),this;var n="webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend";return e.addClass("animated fadeOutLeft").one(n,function(){window.console.log("si hay activos"),window.console.log($(this)),$(this).aaTurnOff().removeClass("animated fadeOutLeft"),$(a).aaTurnOn().aaAnimateCss("fadeInRight")}),this},ajaxSystemList:function(){var e=$(this),n=new FormData;window.console.log(a),n.append("action","fe_system_list"),$.ajax({url:a,type:"POST",data:n,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){},success:function(a){a.elementCount>0&&($("#system-list ul.list-group").html(""),$.each(a.data,function(a,e){var n=$("<li></li>").append($("<h4>"+e.sid+"</h4>")).append($("<p>"+e.shortName+"</p>")).append($("<p>"+e.owner+"</p>")).append($('<a href="#system-info/'+e.id+'">Ver Sistema</a>'));$("#system-list ul.list-group").append(n)}),e.aaContinueLoadContent())},error:function(a,e,n){window.console.log("ERROR: "),window.console.log(a),window.console.log(e+" - "+n),$.alert("Error. Contacte a su Adminsitrador.")}})},ajaxSystemInfo:function(){var e=$(this),n=new FormData;window.console.log(a);var o=window.location.hash.split("/"),t=o[1];n.append("action","fe_system_info"),n.append("system_id",t),$.ajax({url:a,type:"POST",data:n,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){},success:function(a){if($("#system-info").html(""),"ok"===a.status){var n=$("<header></header>").append($("<h1>"+a.system.sid+"</h1>")).append($("<p>"+a.system.shortName+"</p>"));n.append($(a.system.collab)),$("#system-info").append(n);var o=$("<section></section>");o.addClass("data-suppliers"),$.each(a.dataSuppliers,function(a,e){var n=$("<div></div>"),t=$("<div></div>").addClass("panel-heading"),i=$("<div></div>").addClass("panel-body");t.append($("<h4>"+e.title+"</h4>")),void 0!==e.editLink&&i.append($('<a href="'+e.editLink+'">'+e.editText+"</a>")),n.append(t),n.append(i),o.append(n)}),$("#system-info").append(o);var t=$("<section></section>");t.addClass("reports"),$.each(a.reports,function(a,e){var n=$("<div></div>"),o=$("<div></div>").addClass("list-group-item-heading"),i=$("<div></div>").addClass("list-group-item-text");o.append($("<h4>"+e.shortName+"</h4>")),void 0!==e.editLink&&i.append($('<a href="'+e.editLink+'">'+e.editText+"</a>")),void 0!==e.viewLink&&i.append($('<a href="'+e.viewLink+'">'+e.viewText+"</a>")),n.append(o),n.append(i),t.append(n)}),$("#system-info").append(t),e.aaContinueLoadContent()}},error:function(a,e,n){window.console.log("ERROR: "),window.console.log(a),window.console.log(e+" - "+n),$.alert("Error. Contacte a su Adminsitrador.")}})},ajaxSdfmonSetup:function(){var a=$("#sdfmon-setup .sdfmon-setup-calendar"),e=$('<input type="file" id="aa-sdfmon-file"/>').change(window.aaUploadSdfmonFile);return a.html(""),a.append(e),a.aaActivateSdfmonCalendar(),$(this).aaContinueLoadContent(),this},aaActivateSdfmonCalendar:function(){var a=$(this);return a.aaSdfmonGetDates(),this},aaSdfmonGetDates:function(){var e=$(this);window.console.log(e);var n=new FormData,o=window.location.hash.split("/"),t=o[1];return n.append("action","fe_sdfmon_get_dates"),n.append("system_id",t),$.ajax({url:a,type:"POST",data:n,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){},success:function(a){if("ok"===a.status){var n=new Date,o=[];a.dates.length<1?window.console.log("no hay fechas"):($.each(a.dates,function(a,e){var t=e.split("-"),i=new Date(t[0],t[1]-1,t[2]);o[i]=!0,n=new Date(t[0],t[1]-2,t[2])}),window.console.log(o),window.console.log("last day: "+n)),e.aaBuildSdfmonCalendar(o,n)}else window.console.log(a.message),$.alert(a.userMessage)},error:function(a,e,n){window.console.log("ERROR: "),window.console.log(a),window.console.log(e+" - "+n),$.alert("Error. Contacte a su Adminsitrador.")}}),this},aaBuildSdfmonCalendar:function(a,e){var n=$(this);n.datepicker("destroy").datepicker({inline:!0,defaultDate:e,beforeShowDay:function(e){return a[e]?[!1,"aa-used-date","AnÃ¡lisis registrado"]:[!0,"",""]},firstDay:1,showOtherMonths:!0,numberOfMonths:2,nextText:'<i class="fa fa-chevron-right" aria-hidden="true"></i>',prevText:'<i class="fa fa-chevron-left" aria-hidden="true"></i>',dateFormat:"yy/m/d",maxDate:"-1d",monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],yearRange:"2016:2018",dayNamesMin:["D","L","M","M","J","V","S"],onSelect:function(a){window.console.log(a),$("#aa-sdfmon-file").data("file-date",a),window.console.log($("#aa-sdfmon-file").data("file-date")),$("#aa-sdfmon-file").click()}}).datepicker("refresh")},ajaxReportPreview:function(){var e=$(this),n=new FormData;window.console.log(a);var o=window.location.hash.split("/"),t=o[1];n.append("action","fe_preview_report"),n.append("report_id",t),$.ajax({url:a,type:"POST",data:n,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){},success:function(a){void 0===a.error&&$.each(a.sections,function(a,n){var o=$("<section></section>"),t=$("<header></header>").append($("<h2></h2>").append(n.title));o.append(t);var i=$("<div></div>").append($("<p></p>").append(n.intro));o.append(i),$.each(n.charts,function(a,e){var n=$('<div id="aa-chart-'+e.id+'"></div>').addClass("aa-report-chart loading"),t=$('<div id="aa-legend-'+e.id+'"></div>').addClass("aa-report-chart-legend");n.aaBuildChart(e.id),o.append(n),o.append(t)});var d=$("<div></div>").append($("<p></p>").append(n.outro));o.append(d),e.append(o)}),e.aaContinueLoadContent()},error:function(a,e,n){window.console.log("ERROR: "),window.console.log(a),window.console.log(e+" - "+n),$.alert("Error. Contacte a su Adminsitrador.")}})},aaBuildChart:function(e){var n=$(this),o=new FormData;return o.append("action","fe_build_chart"),o.append("chart_id",e),$.ajax({url:a,type:"POST",data:o,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){},success:function(a){if(window.console.log(JSON.stringify(a)),void 0===a.error){var o=new AmCharts.AmSerialChart;if(o.balloonDateFormat="YYYY-MM-DD",o.borderAlpha="0",o.categoryField="date",o.classNamePrefix="aa-adjust",o.dataDateFormat="YYYY-MM-DD",o.dataProvider=a.chart.data,o.decimalSeparator=".",o.marginTop=0,o.marginBottom=0,o.marginRight=0,o.marginLeft=0,o.precision=0,o.thousandsSeparator=",",o.addTitle(a.chart.title,15,"",1,!1),$.each(a.chart.graphs,function(e,n){var t=new AmCharts.AmGraph;"column"!==n.graphType&&(t.bullet="round"),t.bulletSize=3,t.columnWidth=.2,t.fillColors=["#"+n.graphColor,"#FFFFFF"],t.fillAlphas=.1,t.id=n.valueField,t.lineColor="#"+n.graphColor,t.title=n.name,t.type=n.graphType,t.valueField=n.valueField,"none"!==a.chart.stackable&&(t.type="line",t.fillColors=["#"+n.graphColor],t.fillAlphas=.5),o.addGraph(t)}),"0"!==a.chart.legend){var t=new AmCharts.AmLegend;t.align="center",t.enabled=!0,t.fontSize=10,t.markerSize=5,o.addLegend(t,"aa-legend-"+e)}var i=new AmCharts.ChartCursor;o.addChartCursor(i);var d=new AmCharts.ValueAxis;d.stackType=a.chart.stackable,o.addValueAxis(d),o.validateData(),o.write(n.attr("id")),n.removeClass("loading").aaAnimateAndStopCss("fadeIn")}},error:function(a,e,n){window.console.log("ERROR: "),window.console.log(a),window.console.log(e+" - "+n),$.alert("Error. Contacte a su Adminsitrador.")}}),this}}),$("#intro-nav").length>0&&($("#intro-header").scrollex({mode:"top",leave:function(){$("#intro-nav").aaNavbarFixedBehavior("on")},enter:function(){$("#intro-nav").aaNavbarFixedBehavior("off")}}),$("#intro-nav").find("a").scrolly({speed:1e3,offset:function(){return $("#intro-nav").height()}}).each(function(){$(this).aaNavbarActiveSection()})),$(".aa-export").click(function(a){a.preventDefault(),$("#report-preview").wordExport()}),$(window).bind("hashchange",function(){var a=window.location.hash.split("/");$(a[0]).aaLoadContent()}),""===window.location.hash?(window.location.hash="#intro",window.console.log("default hash evaluation")):$(window).trigger("hashchange")});