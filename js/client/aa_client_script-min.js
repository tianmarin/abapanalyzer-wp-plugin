jQuery(document).ready(function($){function e(){var e=$.confirm({buttons:{create:{text:"Crear Sistema",btnClass:"btn-blue",action:function(){return e.$content.find("form").submit(function(a){$(this).aaSubmitSystemForm(a,e)}).trigger("submit"),!1}},cancel:{text:"Cancelar",btnClass:"btn-default",action:function(){}}},closeIcon:!0,columnClass:"large",content:function(){var e=this,t=new FormData;return t.append("action","fe_system_show_form"),$.ajax({url:o,type:"POST",data:t,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){},success:function(a){window.console.log(JSON.stringify(a)),void 0===a.error?(e.setTitle(a.title),e.setContent(a.form)):(e.setTitle("Error"),e.setContent(a.message),e.buttons.create.addClass("hidden"))},error:a})},type:"blue"})}function a(e,a,t){window.console.log("ERROR: "),window.console.log(e),window.console.log(a+" - "+t),$.alert("Error. Contacte a su Adminsitrador.")}function t(e){var a=e,t=$.confirm({buttons:{create:{text:"Editar Sistema",btnClass:"btn-orange",action:function(){return t.$content.find("form").submit(function(e){$(this).aaSubmitSystemForm(e,t)}).trigger("submit"),!1}},cancel:{text:"Cancelar",btnClass:"btn-default",action:function(){}}},closeIcon:!0,columnClass:"large",content:function(){var e=this,t=new FormData;return t.append("action","fe_system_show_form"),t.append("form_type","edit"),t.append("item",a),$.ajax({url:o,type:"POST",data:t,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){},success:function(a){window.console.log(JSON.stringify(a)),void 0===a.error?(e.setTitle(a.title),e.setContent(a.form)):(e.setTitle("Error"),e.setContent(a.message),e.buttons.create.addClass("hidden"))},error:function(a,t,n){window.console.log("ERROR: "),window.console.log(a),window.console.log(t+" - "+n),e.setContent("Error. Contacte a su Adminsitrador.")}})},type:"orange"})}function n(){var e=[],a=new Date;a.setDate(a.getDate()-1);for(var t=0;30>t;t++){var n=new Date(a);n.setDate(n.getDay()+t);var o=Math.round(5*Math.cos(t/2)+5*Math.random()+30),i=Math.round(5*Math.random()+5);e.push({date:n,max:o,avg:i})}return e}var o=aaServerData.ajaxUrl;window.aaUploadSdfmonFile=function(e){if(e.preventDefault(),window.console.log(this),void 0===typeof this.files[0])return window.console.log("No hay archivo. Undefined"),this;var t=this.files[0];if(""===t.name.trim())return $.alert("No has seleccionado un archivo."),window.console.log("No file selected"),this;if(window.console.log("Archivo a evaluar: "+t.name+" "+t.type+" "+t.size),"text/plain"!==t.type)return $.alert("Recuerda que debes cargar archivos exportados sin formato","Error"),this;var n=$(this).data("file-date").split("/"),i=n[0],r=n[1],s=n[2],d=new FormData;d.append("action","fe_sdfmon_file_upload");var l=window.location.hash.split("/"),c=l[1];d.append("system_id",c),d.append("year",i),d.append("month",r),d.append("day",s),d.append("file_name",t.name),d.append("file",t);var u=$("<div class='uploading-msg'></div>").hide(),h='<i class="fa fa-cloud-upload" aria-hidden="true"></i>',p='<i class="fa fa-gear fa-spin" aria-hidden="true"></i>',f='<i class="fa fa-check" aria-hidden="true"></i>';$("#sdfmon-setup .sdfmon-setup-status").append(u),$.ajax({url:o,type:"POST",data:d,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){u.html(h+" "+s+"/"+r+"/"+i+" Comienza la carga del archivo <small>"+t.name+"</small>").fadeIn(500)},xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var a=Math.round(e.loaded/e.total*100);window.console.log("Porcentaje: "+a),u.html(h+" "+s+"/"+r+"/"+i+" Cargando archivo <small>"+t.name+"</small> ("+a+"%)")}},!1),e.upload.addEventListener("load",function(e){e.lengthComputable&&(u.html(p+" "+s+"/"+r+"/"+i+" Procesando la informaci&oacute;n cargada"),setTimeout(function(){$("#sdfmon-setup .sdfmon-setup-calendar").aaActivateSdfmonCalendar()},900))},!1),e.addEventListener("progress",function(e){e.lengthComputable?window.console.log("Respuesta descargada: "+Math.round(e.loaded/e.total*100)+"%"):window.console.log("Respuesta descargada: "+Math.round(e.loaded/e.total*100)+"%")},!1),e},success:function(e){window.console.log(JSON.stringify(e)),"ok"===e.status?(u.html(f+" "+s+"/"+r+"/"+i+" &iexcl;Informaci&oacute;n cargada exitosamente!").delay(5e3).fadeOut(1e3),window.console.log("OK: Carga de "+t.name),$("#sdfmon-setup .sdfmon-setup-calendar").aaActivateSdfmonCalendar()):window.console.log("ERROR: Carga de "+t.name+"("+e.error+")")},error:a})},$.fn.extend({aaAnimateAndStopCss:function(e){return this.addClass("animated "+e),this},aaAnimateCss:function(e){var a="webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend";return this.addClass("animated "+e).one(a,function(){$(this).removeClass("animated "+e)}),this},aaNavbarFixedBehavior:function(e){return"on"===e?$(this).addClass("navbar-fixed-top"):"off"===e&&$(this).removeClass("navbar-fixed-top"),this},aaNavbarActiveSection:function(){var e=$(this),a=e.attr("href"),t=$(a);return t.length<1?this:(t.scrollex({mode:"middle",enter:function(){e.parent().addClass("active")},leave:function(){e.parent().parent().find(".active").removeClass("active")}}),this)},aaLoadContent:function(){if($(this).length<1||!$(this).parent().is("body"))return window.location.hash="#intro",this;var e=$(this).selector;switch(e){case"#system-list":$(this).ajaxSystemList(),$("body").addClass("on-system");break;case"#new-system":$("body").addClass("on-system"),$(this).aaContinueLoadContent();break;case"#system-info":$(this).ajaxSystemInfo(),$("body").addClass("on-system");break;case"#sdfmon-setup":$(this).ajaxSdfmonSetup(),$("body").addClass("on-system");break;case"#edit-report":$("body").addClass("on-system"),$(this).aaContinueLoadContent();break;case"#report-preview":$("body").addClass("on-system"),$(this).ajaxReportPreview();break;case"#system-collab":$("body").addClass("on-system"),$(this).aaContinueLoadContent();break;default:$("body").removeClass("on-system"),$(this).aaContinueLoadContent()}return this},aaTurnOn:function(){return $(this).addClass("active").removeClass("hidden"),this},aaTurnOff:function(){return $(this).addClass("hidden").removeClass("active"),this},aaContinueLoadContent:function(){var e=$(this),a=$("body > .active"),t="#"+a.attr("id");if(window.console.log(t+" -> "+e.selector),window.console.log("activos :"+a.length),e.selector===t)return this;if(a.length<1)return window.console.log("No active Section"),$(this).aaTurnOn(),this;var n="webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend";return a.addClass("animated fadeOutLeft"),a.one(n,function(){window.console.log("Switch active Section"),$(this).aaTurnOff().removeClass("animated fadeOutLeft"),window.console.log($(this).attr("id")+" es el activo"),window.console.log(e.attr("id")+" es el nuevo"),e.aaTurnOn().aaAnimateCss("fadeInRight")}),this},ajaxSystemList:function(){var e=$(this),n=new FormData;return n.append("action","fe_system_list"),$.ajax({url:o,type:"POST",data:n,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){},success:function(a){$("#system-list ul.list-group").html(""),a.elementCount>0&&$.each(a.data,function(e,a){var n=$(a);n.find('a[data-function="system-edit"]').click(function(e){e.preventDefault(),t($(this).data("system-id"))}),$("#system-list ul.list-group").append(n)}),e.aaContinueLoadContent()},error:a}),this},ajaxSystemInfo:function(){var e=$(this),t=new FormData;window.console.log(o);var n=window.location.hash.split("/"),i=n[1];return t.append("action","fe_system_info"),t.append("system_id",i),$.ajax({url:o,type:"POST",data:t,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){},success:function(a){$("#system-info").html(""),"ok"===a.status&&($("#system-info").append(a.systemInfo),e.aaContinueLoadContent())},error:a}),this},ajaxSdfmonSetup:function(){var e=$("#sdfmon-setup .sdfmon-setup-calendar");return e.html(""),e.aaActivateSdfmonCalendar(),$(this).aaContinueLoadContent(),this},aaActivateSdfmonCalendar:function(){var e=$(this);return e.aaSdfmonGetDates(),this},aaSdfmonGetDates:function(){var e=$(this);window.console.log(e);var t=new FormData,n=window.location.hash.split("/"),i=n[1];return t.append("action","fe_sdfmon_get_dates"),t.append("system_id",i),$.ajax({url:o,type:"POST",data:t,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){},success:function(a){if("ok"===a.status){var t=new Date,n=[];a.dates.length<1?window.console.log("no hay fechas"):($.each(a.dates,function(e,a){var o=a.split("-"),i=new Date(o[0],o[1]-1,o[2]);n[i]=!0,t=new Date(o[0],o[1]-2,o[2])}),window.console.log(n),window.console.log("last day: "+t)),e.aaBuildSdfmonCalendar(n,t)}else window.console.log(a.message),$.alert(a.userMessage)},error:a}),this},aaBuildSdfmonCalendar:function(e,a){var t=$(this);return t.datepicker("destroy"),t.datepicker({inline:!0,defaultDate:a,beforeShowDay:function(a){return e[a]?[!1,"aa-used-date","AnÃ¡lisis registrado"]:[!0,"",""]},firstDay:1,showOtherMonths:!0,numberOfMonths:2,nextText:'<i class="fa fa-chevron-right" aria-hidden="true"></i>',prevText:'<i class="fa fa-chevron-left" aria-hidden="true"></i>',dateFormat:"yy/m/d",maxDate:"-1d",monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],yearRange:"2016:2018",dayNamesMin:["D","L","M","M","J","V","S"],onSelect:function(e){window.console.log(e),t.append($('<input type="file">').data("file-date",e).change(window.aaUploadSdfmonFile).click())}}),t.datepicker("refresh"),this},ajaxReportPreview:function(){var e=$(this),t=new FormData;window.console.log(o);var n=window.location.hash.split("/"),i=n[1];return t.append("action","fe_preview_report"),t.append("report_id",i),$.ajax({url:o,type:"POST",data:t,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){},success:function(a){void 0===a.error&&$.each(a.sections,function(a,t){var n=$("<article></article>"),o=$("<header></header>").append($("<h2></h2>").append(t.title));n.append(o);var i=$("<div></div>").append($("<p></p>").append(t.intro));n.append(i),$.each(t.charts,function(e,a){var t=$('<div id="aa-chart-'+a.id+'"></div>').addClass("aa-report-chart loading"),o=$('<div id="aa-legend-'+a.id+'"></div>').addClass("aa-report-chart-legend");t.aaBuildChart(a.id),n.append(t),n.append(o)});var r=$("<div></div>").append($("<p></p>").append(t.outro));n.append(r),e.append(n)}),e.aaContinueLoadContent()},error:a}),this},aaBuildChart:function(e){var t=$(this),n=new FormData;n.append("action","fe_build_chart"),n.append("chart_id",e);var i=window.location.hash.split("/"),r=i[1];return n.append("report_id",r),$.ajax({url:o,type:"POST",data:n,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){},success:function(a){if(window.console.log(JSON.stringify(a)),void 0===a.error){var n=new AmCharts.AmSerialChart;if(n.borderAlpha="0",n.classNamePrefix="aa-adjust","hourly"===a.chart.timeGroup?(n.categoryField="time",n.dataDateFormat="JJ:NN:SS"):(n.categoryField="date",n.dataDateFormat="YYYY-MM-DD"),n.dataProvider=a.chart.data,n.decimalSeparator=".",n.marginTop=0,n.marginBottom=0,n.marginRight=0,n.marginLeft=0,n.precision=0,n.thousandsSeparator=",",n.addTitle(a.chart.title,15,"",1,!1),$.each(a.chart.graphs,function(e,t){var o=new AmCharts.AmGraph;"column"!==t.graphType&&(o.bullet="round"),o.bulletSize=3,o.columnWidth=.2,o.fillColors=["#"+t.graphColor,"#FFFFFF"],o.fillAlphas=.1,o.id=t.valueField,o.lineColor="#"+t.graphColor,o.title=t.name,o.type=t.graphType,o.valueField=t.valueField,"none"!==a.chart.stackable&&(o.type="line",o.fillColors=["#"+t.graphColor],o.fillAlphas=.5),n.addGraph(o)}),"0"!==a.chart.legend){var o=new AmCharts.AmLegend;o.align="center",o.enabled=!0,o.fontSize=10,o.markerSize=5,n.addLegend(o,"aa-legend-"+e)}var i=new AmCharts.ChartCursor;"hourly"===a.chart.timeGroup&&(i.categoryBalloonDateFormat="JJ:NN"),n.addChartCursor(i);var r=n.categoryAxis;"hourly"===a.chart.timeGroup&&(r.minPeriod="hh",r.markPeriodChange=!1),r.parseDates=!0;var s=new AmCharts.ValueAxis;s.stackType=a.chart.stackable,n.addValueAxis(s),n.validateData(),n.invalidateSize(),n.write(t.attr("id")),t.removeClass("loading").aaAnimateAndStopCss("fadeIn")}},error:a}),this},aaSubmitSystemForm:function(e,t){var n=t;e.preventDefault();var i=!0;if($(this).find("input[type!='hidden']").each(function(){$(this).val().length<1?(i=!1,$(this).parent().addClass("has-error")):$(this).parent().removeClass("has-error")}),$(this).find("select").each(function(){$(this).val()<1?(i=!1,$(this).parent().addClass("has-error")):$(this).parent().removeClass("has-error")}),i===!0){var r=new FormData;return r.append("action","fe_create_system"),$(this).find("input, select").each(function(){r.append($(this).attr("name"),$(this).val())}),$.ajax({url:o,type:"POST",data:r,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){},success:function(e){n.close(),void 0===e.error?($("#system-list").ajaxSystemList(),$.alert(e.message)):$.alert(e.message)},error:a}),window.console.log("Validado"),!0}return window.console.log("No Validado"),!1;return!0}}),$("#intro-nav").length>0&&($("#intro-header").scrollex({mode:"top",leave:function(){$("#intro-nav").aaNavbarFixedBehavior("on")},enter:function(){$("#intro-nav").aaNavbarFixedBehavior("off")}}),$("#intro-nav").find("a").scrolly({speed:1e3,offset:function(){return $("#intro-nav").height()}}).each(function(){$(this).aaNavbarActiveSection()})),$(".aa-export").click(function(e){e.preventDefault(),$("#report-preview").wordExport()}),$(window).bind("hashchange",function(){var e=window.location.hash.split("/");$(e[0]).aaLoadContent()}),""===window.location.hash?(window.location.hash="#intro",window.console.log("default hash evaluation")):$(window).trigger("hashchange"),$("#new-system-button").click(function(a){a.preventDefault(),e()});var i=n();AmCharts.makeChart("chartdiv",{type:"serial",dataProvider:i,valueAxes:[{}],graphs:[{id:"g1",bullet:"round",bulletSize:3,filColors:["#63A0D7","#FFF"],fillAlphas:.1,lineColor:"#63A0D7",title:"Max. Active DIA WPs",type:"smoothedLine",valueField:"max"},{id:"g2",bullet:"round",bulletSize:3,filColors:["#E38844","#FFF"],fillAlphas:.1,lineColor:"#E38844",title:"Avg. Active DIA WPs",type:"smoothedLine",valueField:"avg"}],titles:[{text:"ERP | Utilizacion de WorkProcess DIA",size:15}],legend:{align:"center",fontSize:10,markerSize:5},chartCursor:{},categoryField:"date",categoryAxis:{parseDates:!0}})});