jQuery(document).ready(function($){var o,n=[],e=new Date,a,t,i,l=function(o,a){if($("#upload_progress").hide(),0===o)return window.console.log("no hay análisis"),!1;window.console.log("buscando fechas del análisis: "+o);var t=a,i={action:"abap_ajax_get_analysis_sdfmon_dates",analysis:o};return $.post(ajaxurl,i,function(a){return"OK"===a.status?($.each(a.message,function(o,a){var t=a.split("-"),i=new Date(t[0],t[1]-1,t[2]);n[i]=!0,e=i}),window.console.log("Fechas identificadas análisis ("+o+"): "),window.console.log(n),window.console.log("last day: "+e),u(t),!0):(window.console.log("ERROR: Obtención de fechas de sdfmon"),window.console.log("abap_get_sdfmon_dates (response):"+JSON.stringify(a)),!1)},"json")},r=function(){return o=$("#aa_container").data("abap-analysis-id"),0===o?(window.console.log("No Analysis ID found"),!1):(window.console.log("Analysis ID :"+o),o)},p=function(o,n,e){switch(o){case"start":$(".editor_text_status").html(n).fadeIn(500),$("#upload_progress").fadeIn(500);break;case"loading":"number"==typeof e&&($("#upload_progress").progressbar({value:e,max:100}),n=n+" ("+e+"%)"),$(".editor_text_status").html(n);break;case"finished":$(".editor_text_status").html(n).delay(5e3).fadeOut(500),$("#upload_progress").delay(5e3).fadeOut(500);break;case"error":$(".editor_text_status").html(n).fadeIn(500).delay(5e3).fadeOut(500)}return!0},s=function(n,e,a,t){if(!r)return!1;var i=new FormData;i.append("action","abap_ajax_upload_sdfmon_file"),i.append("analysis",o),i.append("year",n),i.append("month",e),i.append("day",a),i.append("sdfmon_file",t),window.console.log(o),$.ajax({url:ajaxurl,type:"POST",data:i,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){p("start","Comienza la carga del archivo "+t.name,0)},xhr:function(){var o=new window.XMLHttpRequest;return o.upload.addEventListener("progress",function(o){if(o.lengthComputable){var n=Math.round(o.loaded/o.total*100);window.console.log("Porcentaje: "+n),p("loading","Cargando "+t.name,n)}},!1),o.upload.addEventListener("load",function(o){o.lengthComputable&&p("loading","Ahora se está procesando el archivo"+t.name)},!1),o.addEventListener("progress",function(o){if(o.lengthComputable){var n=o.loaded/o.total;window.console.log(n)}},!1),o},success:function(o){window.console.log(JSON.stringify(o)),"undefined"==typeof o.error?(p("finished","Finalizado el procesamiento de "+t.name),window.console.log("OK: Carga de "+t.name),l(r(),$("#editor_sdfmon_calendar"))):(p("error","Ha ocurrido un error al procesar "+t.name),window.console.log("ERROR: Carga de "+t.name+"("+o.error+")"))},error:function(o,n,e){p("error","Ha ocurrido un error al cargar "+t.name),window.console.log("ERROR: Carga de "+t.name+": "+o+" - "+n+" - "+e)}})},d=function(o){if(o.preventDefault(),!r)return $.alert("Error Interno: No hay un an&aacute;lisis relacionado."),!1;if("undeined"==typeof this.files[0])return!1;var n=this.files[0],e=n.name,l=n.size,p=n.type;return""===n.name.trim()?($.alert("No has seleccionado un archivo."),window.console.log("No file selected"),!1):(window.console.log("Archivo a evaluar: "+e+" "+p+" "+l),"text/plain"!==p?($.alert("Recuerda que debes cargar archivos exportados sin formato"),a=t=i=0,!1):void(0===a||0===t||0===i?$.confirm({animation:"bottom",closeAnimation:"bottom",closeIcon:!0,closeIconClass:"fa	fa-close",confirmButtonClass:"btn-info",cancelButtonClass:"btn-danger",title:"Indica	la	fecha",content:'<p>Desgraciadamente, los archivos de salida del SnapshotMonitoring, no indican la fecha a la cual pertenece el detalle<p><p>Debes introducir la fecha que corresponde al archivo "'+n.name+'":</p>'+f+v+g,confirmButton:"Cargar	archivo",cancelButton:"Cancelar",confirm:function(){var o=this.$content.find("#year").val(),e=this.$content.find("#month").val(),a=this.$content.find("#day").val();return"0"===o||"0"===e||"0"===a?($.alert("Pon bien la fecha"),window.console.log("Pon bien la fecha"),!1):void s(o,e,a,n)}}):s(a,t,i,n)))},u=function(o){return window.console.log(o),o.datepicker({inline:!0,defaultDate:e,beforeShowDay:function(o){return n[o]?[!1,"aa_sdfmon","Análisis registrado"]:[!0,"",""]},firstDay:1,showOtherMonths:!0,nextText:'<i class="fa fa-chevron-right" aria-hidden="true"></i>',prevText:'<i class="fa fa-chevron-left" aria-hidden="true"></i>',dateFormat:"yy/m/d",yearRange:"2016:2018",dayNamesMin:["D","L","M","M","J","V","S"],onSelect:function(o){c(o)}}),o.datepicker("show"),o.datepicker("refresh"),!0},c=function(o){if(n[o])return $.alert("Ese dia ya tiene datos"),!1;window.console.log("fecha del calendario. "+o);var e=o.split("/");return a=e[0],t=e[1],i=e[2],window.console.log("fechas para cargar: "+a+"/"+t+"/"+i),$("#abap_upload_sdfmon_file input[type=file]").click(),window.console.log("click"),!0};$("#abap_upload_sdfmon_file").submit(function(o){o.preventDefault()}),$("#abap_upload_sdfmon_file input[type=file]").change(d),l(r(),$("#editor_sdfmon_calendar"));var f='<select	id="year"><option	value="0">Año</option><option	value="2010">2010</option><option	value="2011">2011</option><option	value="2012">2012</option><option	value="2013">2013</option><option	value="2014">2014</option><option	value="2015">2015</option><option	value="2016">2016</option><option	value="2017">2017</option><option	value="2018">2018</option><option	value="2019">2019</option><option	value="2020">2020</option></select>',v='<select	id="month"><option	value="0">Mes</option><option	value="1">Enero</option><option	value="2">Febrero</option><option	value="3">Marzo</option><option	value="4">Abril</option><option	value="5">Mayo</option><option	value="6">Junio</option><option	value="7">Julio</option><option	value="8">Agosto</option><option	value="9">Septiembre</option><option	value="10">Octubre</option><option	value="11>Noviembre</option><option	value="12>Diciembre</option></select>',g='<select	id="day"><option	value="0">D&iacute;a</option><option	value="1">01</option><option	value="2">02</option><option	value="3">03</option><option	value="4">04</option><option	value="5">05</option><option	value="6">06</option><option	value="7">07</option><option	value="8">08</option><option	value="9">09</option><option	value="10">10</option><option	value="11">11</option><option	value="12">12</option><option	value="13">13</option><option	value="14">14</option><option	value="15">15</option><option	value="16">16</option><option	value="17">17</option><option	value="18">18</option><option	value="19">19</option><option	value="20">20</option><option	value="21">21</option><option	value="22">22</option><option	value="23">23</option><option	value="24">24</option><option	value="25">25</option><option	value="26">26</option><option	value="27">27</option><option	value="28">28</option><option	value="29">29</option><option	value="30">30</option><option	value="31">31</option></select>'});